# Generated by Anaconda 34.25.2.10
# Generated by pykickstart v3.32
#version=RHEL9

# Use graphical install
#graphical

# Use text install
text

%pre
lsblk
%end


eula --agreed
firstboot --disabled

# enable kdump service
%addon com_redhat_kdump --enable --reserve-mb='auto'
%end
# disable kdump service
#%addon com_redhat_kdump --disable
#%end

# Keyboard layouts
keyboard --xlayouts='ch'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=ens18 --ipv6=auto --activate
network  --hostname=AlmaLinux9-template

# Use CDROM installation media
cdrom

%packages
@^minimal-environment
@core
%end

# Run the Setup Agent on first boot
firstboot --enable

# Partition clearing information
clearpart --drives=vda --initlabel

# Generated using Blivet version 3.6.0
ignoredisk --only-use=/dev/vda
#bootloader --append="crashkernel=no" --location=mbr --boot-drive=vda

autopart

# System timezone
timezone Europe/Zurich --utc

# Root password
rootpw --iscrypted --allow-ssh $1$t1Pgq9Vp$n22WtqFJ2tfkyHEfluy6x0

%post

# permit root login via SSH with password authetication
echo "PermitRootLogin yes" > /etc/ssh/sshd_config.d/01-permitrootlogin.conf

# open-vm-tools is necessary to communicate back to packer,
# otherwise packer will hang waiting for an IP
dnf install -y qemu-guest-agent cloud-init rsync
systemctl enable --now qemu-guest-agent
%end

reboot --eject